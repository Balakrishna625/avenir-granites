"use strict";(()=>{var e={};e.id=258,e.ids=[258],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},2361:e=>{e.exports=require("events")},3685:e=>{e.exports=require("http")},5687:e=>{e.exports=require("https")},1808:e=>{e.exports=require("net")},5477:e=>{e.exports=require("punycode")},2781:e=>{e.exports=require("stream")},4404:e=>{e.exports=require("tls")},7310:e=>{e.exports=require("url")},9796:e=>{e.exports=require("zlib")},8603:(e,r,s)=>{s.r(r),s.d(r,{originalPathname:()=>f,patchFetch:()=>_,requestAsyncStorage:()=>b,routeModule:()=>d,serverHooks:()=>x,staticGenerationAsyncStorage:()=>m});var t={};s.r(t),s.d(t,{DELETE:()=>g,GET:()=>l,POST:()=>c,PUT:()=>u});var n=s(9303),o=s(8716),a=s(670),i=s(7070),p=s(2632);async function l(e){try{let r=new URL(e.url),s=r.searchParams.get("consignment_id"),t=r.searchParams.get("block_id"),n=p.p.from("granite_block_parts").select(`
        *,
        granite_blocks!inner (
          id,
          block_no,
          consignment_id,
          granite_consignments!inner (
            id,
            consignment_number,
            supplier_id,
            granite_suppliers (
              id,
              name
            )
          )
        )
      `);s&&(n=n.eq("granite_blocks.consignment_id",s)),t&&(n=n.eq("block_id",t));let{data:o,error:a}=await n.order("created_at",{ascending:!1});if(a)return console.error("Database error fetching slab processing:",a),i.NextResponse.json({error:a.message},{status:500});return i.NextResponse.json(o)}catch(e){return console.error("Server error fetching slab processing:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function c(e){try{let r=await e.json();console.log("Slab processing creation request:",r);let{block_id:s,part_name:t,slabs_count:n,sqft:o,thickness:a}=r;if(!s||!t||!n||!o)return console.log("Missing required fields:",{block_id:s,part_name:t,slabs_count:n,sqft:o}),i.NextResponse.json({error:"Required fields missing"},{status:400});let l={block_id:s,part_name:t.toUpperCase(),slabs_count:parseInt(n),sqft:parseFloat(o),thickness:parseFloat(a)||20,status:"PRODUCED"};console.log("Inserting slab processing data:",l);let{data:c,error:u}=await p.p.from("granite_block_parts").insert(l).select(`
        *,
        granite_blocks (
          id,
          block_no,
          consignment_id
        )
      `).single();if(u)return console.error("Database error creating slab processing:",u),i.NextResponse.json({error:u.message},{status:400});return console.log("Slab processing created successfully:",c),i.NextResponse.json(c,{status:201})}catch(e){return console.error("Server error creating slab processing:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function u(e){try{let{id:r,part_name:s,slabs_count:t,sqft:n,thickness:o}=await e.json();if(!r)return i.NextResponse.json({error:"Slab processing ID required"},{status:400});let a={part_name:s?.toUpperCase(),slabs_count:parseInt(t),sqft:parseFloat(n),thickness:parseFloat(o)},{data:l,error:c}=await p.p.from("granite_block_parts").update(a).eq("id",r).select().single();if(c)return console.error("Database error updating slab processing:",c),i.NextResponse.json({error:c.message},{status:400});return i.NextResponse.json(l)}catch(e){return console.error("Server error updating slab processing:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function g(e){try{let r=new URL(e.url).searchParams.get("id");if(!r)return i.NextResponse.json({error:"Slab processing ID required"},{status:400});let{error:s}=await p.p.from("granite_block_parts").delete().eq("id",r);if(s)return console.error("Database error deleting slab processing:",s),i.NextResponse.json({error:s.message},{status:400});return i.NextResponse.json({success:!0})}catch(e){return console.error("Server error deleting slab processing:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let d=new n.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/slab-processing/route",pathname:"/api/slab-processing",filename:"route",bundlePath:"app/api/slab-processing/route"},resolvedPagePath:"/Users/bala/Downloads/granite-ledger-1/app/api/slab-processing/route.ts",nextConfigOutput:"",userland:t}),{requestAsyncStorage:b,staticGenerationAsyncStorage:m,serverHooks:x}=d,f="/api/slab-processing/route";function _(){return(0,a.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:m})}},2632:(e,r,s)=>{let t;s.d(r,{p:()=>t});var n=s(2814);let o=process.env.SUPABASE_URL,a=process.env.SUPABASE_SERVICE_ROLE;o&&a?t=(0,n.eI)(o,a,{auth:{persistSession:!1}}):(console.warn("Missing Supabase environment variables. Using dummy client."),t={from:()=>({select:()=>({data:[],error:Error("Supabase not configured")}),insert:()=>({data:null,error:Error("Supabase not configured")}),update:()=>({data:null,error:Error("Supabase not configured")}),delete:()=>({data:null,error:Error("Supabase not configured")})})})}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[948,505],()=>s(8603));module.exports=t})();